/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package admin_dashboard;

import config.dbconnector;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import javax.swing.JOptionPane;

/**
 *
 * @author Dela Cuesta
 */
public class Movies_edit extends javax.swing.JFrame {

    /**
     * Creates new form Movies_edit
     */
    public Movies_edit() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panel = new javax.swing.JPanel();
        title = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        m_price = new javax.swing.JTextField();
        jLabel7 = new javax.swing.JLabel();
        r_year = new javax.swing.JTextField();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        runtime = new javax.swing.JTextField();
        jLabel10 = new javax.swing.JLabel();
        addBT = new javax.swing.JButton();
        mID = new javax.swing.JTextField();
        jLabel16 = new javax.swing.JLabel();
        cancel = new javax.swing.JButton();
        update = new javax.swing.JButton();
        delete = new javax.swing.JButton();
        director = new javax.swing.JTextField();
        moviestatus = new javax.swing.JComboBox<>();
        jLabel5 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        cinema = new javax.swing.JComboBox<>();
        genre = new javax.swing.JTextField();
        jLabel11 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        panel.setBackground(new java.awt.Color(0, 0, 0));
        panel.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(235, 235, 235)));
        panel.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        title.setBackground(new java.awt.Color(102, 102, 102));
        title.setFont(new java.awt.Font("Yu Gothic UI", 0, 10)); // NOI18N
        title.setForeground(new java.awt.Color(255, 255, 255));
        title.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                titleActionPerformed(evt);
            }
        });
        panel.add(title, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 250, 120, 30));

        jLabel4.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel4.setForeground(new java.awt.Color(255, 255, 255));
        jLabel4.setText("Movie Status");
        panel.add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(540, 90, -1, -1));

        m_price.setBackground(new java.awt.Color(102, 102, 102));
        m_price.setFont(new java.awt.Font("Yu Gothic UI", 0, 10)); // NOI18N
        m_price.setForeground(new java.awt.Color(255, 255, 255));
        m_price.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                m_priceActionPerformed(evt);
            }
        });
        panel.add(m_price, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 310, 120, 30));

        jLabel7.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel7.setForeground(new java.awt.Color(255, 255, 255));
        jLabel7.setText("Price:");
        panel.add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 290, -1, 20));

        r_year.setBackground(new java.awt.Color(102, 102, 102));
        r_year.setFont(new java.awt.Font("Yu Gothic UI", 0, 10)); // NOI18N
        r_year.setForeground(new java.awt.Color(255, 255, 255));
        r_year.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                r_yearActionPerformed(evt);
            }
        });
        panel.add(r_year, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 180, 120, 30));

        jLabel8.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel8.setForeground(new java.awt.Color(255, 255, 255));
        jLabel8.setText("Release year:");
        panel.add(jLabel8, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 160, -1, 20));

        jLabel9.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel9.setForeground(new java.awt.Color(255, 255, 255));
        jLabel9.setText("Run time:");
        panel.add(jLabel9, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 160, -1, 20));

        runtime.setBackground(new java.awt.Color(102, 102, 102));
        runtime.setFont(new java.awt.Font("Yu Gothic UI", 0, 10)); // NOI18N
        runtime.setForeground(new java.awt.Color(255, 255, 255));
        runtime.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                runtimeActionPerformed(evt);
            }
        });
        panel.add(runtime, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 180, 120, 30));

        jLabel10.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel10.setForeground(new java.awt.Color(255, 255, 255));
        jLabel10.setText("Director:");
        panel.add(jLabel10, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 90, -1, 20));

        addBT.setBackground(new java.awt.Color(51, 102, 255));
        addBT.setFont(new java.awt.Font("Microsoft Sans Serif", 1, 12)); // NOI18N
        addBT.setForeground(new java.awt.Color(255, 255, 255));
        addBT.setText("ADD");
        addBT.setBorder(null);
        addBT.setBorderPainted(false);
        addBT.setOpaque(false);
        addBT.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                addBTActionPerformed(evt);
            }
        });
        panel.add(addBT, new org.netbeans.lib.awtextra.AbsoluteConstraints(570, 170, 90, 30));

        mID.setBackground(new java.awt.Color(102, 102, 102));
        mID.setFont(new java.awt.Font("Yu Gothic UI", 0, 10)); // NOI18N
        mID.setForeground(new java.awt.Color(100, 115, 122));
        mID.setEnabled(false);
        mID.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                mIDActionPerformed(evt);
            }
        });
        panel.add(mID, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 110, 120, 30));

        jLabel16.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel16.setForeground(new java.awt.Color(255, 255, 255));
        jLabel16.setText("Movie ID");
        panel.add(jLabel16, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 90, 60, 20));

        cancel.setBackground(new java.awt.Color(0, 0, 0));
        cancel.setFont(new java.awt.Font("Microsoft Sans Serif", 1, 12)); // NOI18N
        cancel.setForeground(new java.awt.Color(255, 255, 255));
        cancel.setText("CANCEL");
        cancel.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                cancelMouseClicked(evt);
            }
        });
        cancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelActionPerformed(evt);
            }
        });
        panel.add(cancel, new org.netbeans.lib.awtextra.AbsoluteConstraints(570, 290, 90, 30));

        update.setBackground(new java.awt.Color(51, 102, 255));
        update.setFont(new java.awt.Font("Microsoft Sans Serif", 1, 12)); // NOI18N
        update.setForeground(new java.awt.Color(255, 255, 255));
        update.setText("UPDATE");
        update.setEnabled(false);
        update.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                updateMouseClicked(evt);
            }
        });
        update.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                updateActionPerformed(evt);
            }
        });
        panel.add(update, new org.netbeans.lib.awtextra.AbsoluteConstraints(570, 210, 90, 30));

        delete.setBackground(new java.awt.Color(51, 102, 255));
        delete.setFont(new java.awt.Font("Microsoft Sans Serif", 1, 12)); // NOI18N
        delete.setForeground(new java.awt.Color(255, 255, 255));
        delete.setText("ARCHIVE");
        delete.setPreferredSize(new java.awt.Dimension(60, 30));
        delete.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                deleteActionPerformed(evt);
            }
        });
        panel.add(delete, new org.netbeans.lib.awtextra.AbsoluteConstraints(570, 250, 90, -1));

        director.setBackground(new java.awt.Color(102, 102, 102));
        director.setFont(new java.awt.Font("Yu Gothic UI", 0, 10)); // NOI18N
        director.setForeground(new java.awt.Color(255, 255, 255));
        director.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                directorActionPerformed(evt);
            }
        });
        panel.add(director, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 110, 120, 30));

        moviestatus.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        moviestatus.setForeground(new java.awt.Color(102, 102, 102));
        moviestatus.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Active" }));
        moviestatus.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                moviestatusActionPerformed(evt);
            }
        });
        panel.add(moviestatus, new org.netbeans.lib.awtextra.AbsoluteConstraints(540, 110, 120, 24));

        jLabel5.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel5.setForeground(new java.awt.Color(255, 255, 255));
        jLabel5.setText("Title:");
        panel.add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 230, -1, -1));

        jLabel1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/Image/filmdoodle.jpg"))); // NOI18N
        panel.add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 180, 380));

        cinema.setBackground(new java.awt.Color(153, 153, 153));
        cinema.setForeground(new java.awt.Color(255, 255, 255));
        cinema.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Select Cinema", "C1", "C2", "C3", "C4" }));
        cinema.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                cinemaMouseClicked(evt);
            }
        });
        panel.add(cinema, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 310, 120, 30));

        genre.setBackground(new java.awt.Color(102, 102, 102));
        genre.setFont(new java.awt.Font("Yu Gothic UI", 0, 10)); // NOI18N
        genre.setForeground(new java.awt.Color(255, 255, 255));
        genre.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                genreActionPerformed(evt);
            }
        });
        panel.add(genre, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 250, 120, 30));

        jLabel11.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel11.setForeground(new java.awt.Color(255, 255, 255));
        jLabel11.setText("Genre:");
        panel.add(jLabel11, new org.netbeans.lib.awtextra.AbsoluteConstraints(380, 230, -1, 20));

        jLabel12.setFont(new java.awt.Font("Microsoft Sans Serif", 0, 14)); // NOI18N
        jLabel12.setForeground(new java.awt.Color(255, 255, 255));
        jLabel12.setText("Cinema:");
        panel.add(jLabel12, new org.netbeans.lib.awtextra.AbsoluteConstraints(220, 290, -1, 20));

        getContentPane().add(panel, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, 730, 380));

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>//GEN-END:initComponents

    private void titleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_titleActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_titleActionPerformed

    private void m_priceActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_m_priceActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_m_priceActionPerformed

    private void r_yearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_r_yearActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_r_yearActionPerformed

    private void runtimeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_runtimeActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_runtimeActionPerformed

    private void addBTActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_addBTActionPerformed

        if (title.getText().isEmpty() || m_price.getText().isEmpty() || runtime.getText().isEmpty()
        || r_year.getText().isEmpty() || director.getText().isEmpty()) {

    JOptionPane.showMessageDialog(null, "All fields are required!");
} else {
    dbconnector dbc = new dbconnector();

    // Extract the numeric part of the cinema ID
    String selectedCinema = cinema.getSelectedItem().toString();
    String cinemaIdStr = selectedCinema.replaceAll("[^0-9]", ""); // Remove non-numeric characters
    int cinemaId = Integer.parseInt(cinemaIdStr);

   String insertQuery = "INSERT INTO tbl_movies (title, r_year, genre, run_time, director, movie_status, c_id, m_price) "
        + "VALUES ('"
        + title.getText() + "','"
        + r_year.getText() + "','"
        + genre.getText() + "','"
        + runtime.getText() + "','"
        + director.getText() + "','"
        + moviestatus.getSelectedItem().toString() + "',"
        + cinemaId + ","
        + m_price.getText() + ")";


    if (dbc.insertData(insertQuery)) {
        JOptionPane.showMessageDialog(null, "Movie added successfully!");
        ManageMovies rA = new ManageMovies();
        rA.setVisible(true);
        this.dispose();
    } else {
        JOptionPane.showMessageDialog(null, "Error adding movie!");
    }
}

      
    }//GEN-LAST:event_addBTActionPerformed

    private void mIDActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_mIDActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_mIDActionPerformed

    private void cancelMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cancelMouseClicked

    }//GEN-LAST:event_cancelMouseClicked

    private void cancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelActionPerformed

        ManageMovies u = new ManageMovies();
        u.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_cancelActionPerformed

    private void updateMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_updateMouseClicked

    }//GEN-LAST:event_updateMouseClicked

    private void updateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_updateActionPerformed

        if(title.getText().isEmpty() || r_year.getText().isEmpty() || m_price.getText().isEmpty()
            || runtime.getText().isEmpty() || director.getText().isEmpty() )
        {

            JOptionPane.showMessageDialog(null,"All fields are required!");

        }
        else{

            dbconnector dbc = new dbconnector();

            dbc.updateData("UPDATE tbl_movies SET title = '" + title.getText() 
                + "', r_year = '" + r_year.getText()
                + "', genre = '" + genre.getText() 
                + "', run_time = '" + runtime.getText()
                + "', director = '" + director.getText()
                +  "', movie_status = '" + moviestatus.getSelectedItem()
                +  "', m_price = '" + m_price.getText()
                + "' WHERE m_id = '" + mID.getText() + "'");

            ManageMovies u = new ManageMovies();
            u.setVisible(true);
            this.dispose();
        }
    }//GEN-LAST:event_updateActionPerformed

    private void deleteActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_deleteActionPerformed
        dbconnector dbc = new dbconnector();

        String sql = "UPDATE tbl_movies SET movie_status = ? WHERE m_id = ?";

        try (PreparedStatement pst = dbc.connect.prepareStatement(sql)) {
            pst.setString(1, "Archived");
            pst.setString(2, mID.getText());
            int rowsAffected = pst.executeUpdate();

            if (rowsAffected > 0) {
                JOptionPane.showMessageDialog(null, "Movie data archived.");

                ManageMovies u = new ManageMovies();
                u.setVisible(true);
                this.dispose();
            } else {
                JOptionPane.showMessageDialog(null, "No records found to archive.");
            }
        } catch (SQLException ex) {
            JOptionPane.showMessageDialog(null, "SQL Error: " + ex.getMessage());
        }
    }//GEN-LAST:event_deleteActionPerformed

    private void directorActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_directorActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_directorActionPerformed

    private void moviestatusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_moviestatusActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_moviestatusActionPerformed

    private void cinemaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cinemaMouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_cinemaMouseClicked

    private void genreActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_genreActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_genreActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(Movies_edit.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(Movies_edit.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(Movies_edit.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(Movies_edit.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new Movies_edit().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    public javax.swing.JButton addBT;
    public javax.swing.JButton cancel;
    private javax.swing.JComboBox<String> cinema;
    private javax.swing.JButton delete;
    public javax.swing.JTextField director;
    public javax.swing.JTextField genre;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    public javax.swing.JTextField mID;
    public javax.swing.JTextField m_price;
    public javax.swing.JComboBox<String> moviestatus;
    private javax.swing.JPanel panel;
    public javax.swing.JTextField r_year;
    public javax.swing.JTextField runtime;
    public javax.swing.JTextField title;
    public javax.swing.JButton update;
    // End of variables declaration//GEN-END:variables
}
